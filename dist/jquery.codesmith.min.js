/*!
 * codeSmith - jQuery code editor helper plugin
 * https://github.com/goonruntongue/codeSmith
 *
 * MIT License
 *
 * Copyright (c) 2025 Katsuyori Murakami
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */ !function(e){e.fn.codeSmith=function(t){let l=e.extend(!0,{},{lang:"js",autoComplete:{},indentUnit:"    "},t),n=l.indentUnit;return this.each(function(){let t=this,i=e(this),s=i.data("code")||l.lang;i.attr("data-code",s);let c=function e(t){let l=[];return Object.keys(t).forEach(e=>{let n=t[e],i=0;n.endsWith("()")?i=-1:n.endsWith("{}")&&(i=-1),l.push({short:e,full:n,offset:i})}),l}(l.autoComplete);i.on("keydown",function(e){let l=t.value,i=t.selectionStart,s=t.selectionEnd,c=(e,n)=>{let c=l.slice(0,i),r=l.slice(s);t.value=c+e+r;let a=c.length+n;t.selectionStart=t.selectionEnd=a};if("Tab"===e.key){e.preventDefault();let r=t.value,a=t.selectionStart,o=t.selectionEnd;if(!e.shiftKey){if(a===o){let u=r.slice(0,a),f=r.slice(o);t.value=u+n+f;let h=a+n.length;t.selectionStart=t.selectionEnd=h;return}let d=r.lastIndexOf("\n",a-1)+1,g=r.indexOf("\n",o);-1===g&&(g=r.length);let _=r.slice(0,d),v=r.slice(d,g),E=r.slice(g),S=v.replace(/^/gm,n);t.value=_+S+E;let $=v.split("\n").length,k=n.length*$,p=a+n.length;t.selectionStart=p,t.selectionEnd=o+k;return}let y=t.value,x=t.selectionStart,O=t.selectionEnd,D=y.lastIndexOf("\n",x-1)+1,w=y.indexOf("\n",O);-1===w&&(w=y.length);let I=y.slice(0,D),m=y.slice(D,w),b=y.slice(w),A=m.replace(/^ {1,4}/gm,"");t.value=I+A+b,t.selectionStart=D,t.selectionEnd=D+A.length;return}if(e.altKey&&("ArrowUp"===e.key||"ArrowDown"===e.key)){e.preventDefault();let K=t.value,U=t.selectionStart,W=t.selectionEnd,C=function e(t,l,n){let i=t.lastIndexOf("\n",l-1)+1,s=t.indexOf("\n",n);-1===s&&(s=t.length);let c=s;return c<t.length&&(c+=1),{blockStart:i,blockEnd:c}}(K,U,W),j=C.blockStart,T=C.blockEnd,L=K.slice(j,T),q=T-j;if(e.shiftKey){let z=K.slice(0,j),B=K.slice(T);if(t.value=z+L+L+B,"ArrowUp"===e.key)t.selectionStart=j,t.selectionEnd=j+q;else{let F=j+q;t.selectionStart=F,t.selectionEnd=F+q}return}if("ArrowUp"===e.key){if(0===j)return;let G=K.lastIndexOf("\n",j-2),H=-1===G?0:K.lastIndexOf("\n",G-1)+1,J=K.slice(0,H),M=K.slice(H,j),N=K.slice(T);t.value=J+L+M+N,t.selectionStart=H+(U-j),t.selectionEnd=H+(W-j);return}if("ArrowDown"===e.key){if(T>=K.length)return;let P=T,Q=K.indexOf("\n",P);-1===Q&&(Q=K.length);let R=Q;R<K.length&&(R+=1);let V=K.slice(0,j),X=K.slice(P,R),Y=K.slice(R);t.value=V+X+L+Y;let Z=X.length;t.selectionStart=U+Z,t.selectionEnd=W+Z;return}}if(e.ctrlKey&&"k"===e.key.toLowerCase()){e.preventDefault();let ee=t.value,et=t.selectionStart,el=t.selectionEnd,en=ee.lastIndexOf("\n",et-1)+1,ei=ee.indexOf("\n",el);-1===ei&&(ei=ee.length);let es=en,ec=ei;ec<ee.length?ec+=1:es>0&&"\n"===ee[es-1]&&(es-=1);let er=ee.slice(0,es),ea=ee.slice(ec);t.value=er+ea,t.selectionStart=t.selectionEnd=es;return}if("("===e.key){e.preventDefault(),c("()",1);return}if("{"===e.key){e.preventDefault(),c("{}",1);return}if('"'===e.key){e.preventDefault();let eo=l.slice(0,i),eu=l.slice(i,s),ef=l.slice(s);if(i===s){t.value=eo+'""'+ef;let eh=eo.length+1;t.selectionStart=t.selectionEnd=eh}else{t.value=eo+'"'+eu+'"'+ef;let ed=eo.length+1,eg=ed+eu.length;t.selectionStart=ed,t.selectionEnd=eg}return}if("Enter"===e.key){e.preventDefault();let e_=l.slice(0,i),ev=l.slice(s),eE=function e(t,l){let n=t.lastIndexOf("\n",l-1)+1,i=t.slice(n,l),s=i.match(/^[\t ]*/);return s?s[0]:""}(l,i),eS=e_.slice(-1),e$=ev.slice(0,1);if("{"===eS&&"}"===e$||"("===eS&&")"===e$){let ek=eE+n;t.value=e_+("\n"+ek)+"\n"+eE+ev;let ep=e_.length+1+ek.length;t.selectionStart=t.selectionEnd=ep;return}t.value=e_+"\n"+eE+ev;let ey=e_.length+1+eE.length;t.selectionStart=t.selectionEnd=ey;return}if(e.ctrlKey&&"/"===e.key){e.preventDefault();let ex=t.selectionStart,eO=t.selectionEnd,eD=t.value,ew=t.dataset.code||"js",eI="",em="";"html"===ew?(eI="<!--",em="-->"):(eI="/*",em="*/");let eb=eD.slice(0,ex),eA=eD.slice(ex,eO),eK=eD.slice(eO),eU=eb.endsWith(eI),eW=eK.startsWith(em);if(eU&&eW){let eC=eb.slice(0,eb.length-eI.length),ej=eK.slice(em.length);t.value=eC+eA+ej;let eT=eC.length,eL=eT+eA.length;t.selectionStart=eT,t.selectionEnd=eL;return}if(ex===eO){let e0=eD.lastIndexOf("\n",ex-1)+1,e2=eD.indexOf("\n",ex);-1===e2&&(e2=eD.length);let eq=eD.slice(e0,e2);if(0===eq.length){let ez=eI+em;t.value=eb+ez+eK;let eB=eb.length+eI.length;t.selectionStart=t.selectionEnd=eB;return}ex=e0,eO=e2,eb=eD.slice(0,ex),eA=eD.slice(ex,eO),eK=eD.slice(eO)}let eF=eI+eA+em;t.value=eb+eF+eK;let eG=eb.length+eI.length,eH=eG+eA.length;t.selectionStart=eG,t.selectionEnd=eH;return}}),i.on("input",function(e){let l=t.value,n=t.selectionStart,i=e.originalEvent&&e.originalEvent.inputType;if(!(i&&i.startsWith("delete")))for(let s of c){let r=s.short.length;if(n>=r){let a=l.slice(n-r,n);if(a===s.short){let o=l.slice(0,n-r),u=l.slice(n),f=o+s.full+u;t.value=f;let h=s.full.length,d=s.offset||0,g=o.length+h+d;t.selectionStart=t.selectionEnd=g;break}}}})})}}(jQuery);